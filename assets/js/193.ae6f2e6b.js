(window.webpackJsonp=window.webpackJsonp||[]).push([[193],{563:function(e,a,s){"use strict";s.r(a);var t=s(42),r=Object(t.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h1",{attrs:{id:"module"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#module"}},[e._v("#")]),e._v(" Module")]),e._v(" "),s("h2",{attrs:{id:"新建"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#新建"}},[e._v("#")]),e._v(" 新建")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("# 生成 vote 表，并建立一列\nrails generate model vote topic_id:integer\n# 写入数据库\nrake db:migrate\n\n# 建立 Model: post，同时生成\n# post 的二個欄位: content(text 文字屬性) 跟 group_id (integer 整數屬性)0\nrails g model post content:text group_id:integer\nrake db:migrate\n")])])]),s("h2",{attrs:{id:"查询"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查询"}},[e._v("#")]),e._v(" 查询")]),e._v(" "),s("ul",[s("li",[e._v("rails console 控制台查询")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("rails c  # 命令行中进入控制台\nfirst_user = User.first  # 查询第一个用户资料\nfirst_user.microposts  # 查询关联表\n")])])]),s("ul",[s("li",[e._v("设定 scope 查询，提高复用")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("class Product < ActiveRecord::Base\n  scope :active, -> { where state: 'active' }\n  scope :inactive, -> { where state: 'inactive' }\nend\n")])])]),s("ul",[s("li",[e._v("默认 scope scope 查询")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("default_scope { order('external_updated_at') }\n")])])]),s("ul",[s("li",[e._v("模糊查询")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("hospitals = Hospital.where('name LIKE ?', \"%#{name}%\")\n")])])]),s("ul",[s("li",[e._v("联合查询")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("  scope :filter_by_role, -> (role){\n    .joins(:roles).where('roles.name' => role)\n  }\n")])])]),s("ul",[s("li",[e._v("模糊加联合")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('    includes(:user).where{(resumes.users.show_name =~  "%#{name}%")} if name.present?\n')])])]),s("ul",[s("li",[e._v("查询某列，得到一个数组")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("Person.pluck(:id) # SELECT people.id FROM people\nPerson.uniq.pluck(:role) # SELECT DISTINCT role FROM people\nPerson.where(:confirmed => true).limit(5).pluck(:id)\n")])])]),s("h2",{attrs:{id:"设置字段serialize"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置字段serialize"}},[e._v("#")]),e._v(" 设置字段serialize")]),e._v(" "),s("ul",[s("li",[e._v("避免数据库转译后出现 \\反斜矼")])]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("    serialize :prepaid_detail, JSON\n")])])]),s("h2",{attrs:{id:"验证"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#验证"}},[e._v("#")]),e._v(" 验证")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("#设置字段不能为空\nvalidates :title, presence: true\n\n#可以为某个 action 设置\nvalidates :title, presence: true, on: :create\n\n# 另一种写法\nvalidates_presence_of :name\n")])])]),s("p",[e._v("其中的validates_presence_of宣告了name這個屬性是必填")]),e._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("> e = Event.new\n> e.save # 回傳 false\n> e.errors.full_messages # 列出驗證失敗的原因\n> e.name = 'ihower'\n> e.save\n> e.errors.full_messages # 儲存成功，變回空陣列 []\n")])])]),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("validates :price, presence: true\n")])])])])}),[],!1,null,null,null);a.default=r.exports}}]);